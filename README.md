# Create Custom RAG Agents

A FastAPI-based backend that lets users create their own Retrieval-Augmented Generation (RAG) agents (‚Äúbots‚Äù).  
Each bot can be powered by:

- **Crawled content from public websites** (via `crawl4ai`)
- **Uploaded documents** (PDF, DOCX, TXT, CSV/Excel)
- **Vector search in Pinecone**
- **Responses generated by Gemini 2.0 Flash**

The app uses **MongoDB + Beanie** for persistence and **JWT-based authentication** for users.

---

## ‚ú® Features

- **User Management**
  - Register users
  - Login with email & password
  - JWT auth (`Bearer` token) for protected endpoints

- **Bot Management**
  - Create, read, update, delete bots
  - Associate each bot with a user
  - Configure:
    - `name`
    - `language`
    - `systemPrompt` (system message for the LLM)

- **Website Crawling (RAG Source 1)**
  - Crawl a public website using `crawl4ai`
  - Save crawled pages as markdown in `crawlOutput/`
  - Load all markdown files, split into chunks
  - Store chunks temporarily in MongoDB (`temp_storage` collection)

- **File Upload (RAG Source 2)**
  - Upload one or more files:
    - `.txt`
    - `.pdf`
    - `.docx`
    - Tabular files (via `pandas` ‚Äì e.g., CSV/Excel)
  - Extract text using `PyPDF2`, `python-docx`, `pandas`
  - Split into chunks
  - Store chunks temporarily in MongoDB (`temp_storage` collection)

- **Vectorization & Storage**
  - Use **SentenceTransformers** (`all-MiniLM-L6-v2`) to create embeddings
  - Store embeddings in a **Pinecone serverless index**
  - Each vector has metadata `{ "text": ..., "botId": ... }`

- **Chat with RAG Agents**
  - Retrieve top-K relevant chunks from Pinecone for a given `botId`
  - Call **Gemini 2.0 Flash** with system prompt and context
  - Store chat history in MongoDB

---

## ‚öôÔ∏è Environment Variables

```
MONGO_URI=
DB_NAME=
JWT_SECRET_KEY=
PINECONE_API_KEY=
PINECONE_INDEX_NAME=
PINECONE_NAMESPACE=
GEMINI_API_KEY=
```

---

## üöÄ Getting Started

### Create & activate virtual environment
```
python -m venv myvenv
source myvenv/bin/activate   # Linux/macOS
.\myvenv\Scripts\activate    # Windows
```

### Install dependencies
```
pip install -r requirements.txt
playwright install
```

### Run FastAPI
```
uvicorn main:app --reload
```

Swagger UI: http://localhost:8000/docs

---

## üì° API Overview

Includes endpoints for:

- **User Management**: register, login, list, update, delete  
- **Bot Management**: create, list, update, delete  
- **Crawling**: POST /bots/crawl  
- **Upload Knowledge Files**: POST /bots/upload-files  
- **Chat with Bot**: POST /bots/response?bot_id=...  

---

## üß† RAG Pipeline Overview

1. User uploads files or crawls a website.  
2. Text is extracted, chunked, and stored temporarily.  
3. Bot is created and chunks are embedded + stored in Pinecone.  
4. User queries the bot:  
   - Embed query  
   - Retrieve context from Pinecone  
   - Gemini generates response  
   - Chat history is saved  
